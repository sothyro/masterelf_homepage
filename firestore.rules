rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // Appointments: allow create only (no list/read/update/delete from client).
    // Reading and updates are done via Cloud Functions (getMyBookings, cancelBooking).
    match /appointments/{docId} {
      allow create: if request.resource.data.name is string
                   && request.resource.data.phone is string
                   && request.resource.data.phone.size() >= 8
                   && request.resource.data.serviceId is string
                   && request.resource.data.serviceName is string
                   && request.resource.data.date is string
                   && request.resource.data.time is string
                   && request.resource.data.status == 'pending'
                   && request.resource.data.startTime is timestamp
                   && request.resource.data.endTime is timestamp
                   && request.resource.data.durationMinutes is int
                   && request.resource.data.durationMinutes >= 60
                   && request.resource.data.durationMinutes <= 480
                   && request.resource.data.breakAfterMinutes is int
                   && request.resource.data.breakAfterMinutes >= 0
                   && request.resource.data.breakAfterMinutes <= 120
                   && request.resource.data.bookingReference is string
                   && request.resource.data.bookingReference.size() >= 4
                   && request.resource.data.bookingReference.size() <= 20;
      allow read, update, delete: if false;
    }
  }
}
